<html>
    <head>
        <title>Shoutout Clips by secondubly</title>
            <script type="text/javascript" src="/clippy/js/clippy.js"></script>
            <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed&display=swap" rel="stylesheet"> 
        <style type="text/css">
            iframe {
                border: 0;
            }
            html, body {
                background-color: rgba(0, 0, 0, 0);
                overflow: hidden;
                color: #fff;
                text-transform: uppercase;
                margin: 0;
                padding: 0;
                text-align: center;
                font-family: 'Roboto Condensed', sans-serif;
                font-weight: 700;
            }
            #clip-container {
                opacity: 0;
                font-size: 3.75em;
                -webkit-transition: opacity 1900ms;
                -o-transition: opacity 1900ms;
                transition: opacity 1900ms;
            }
            #clip-container.show {
                opacity: 1;
            }
            #clip-container p {
                text-align: center;
                margin-bottom: 1em;
            }
        </style>
    </head>
    <body>
        <div id="clip-container">
            <p>Check out <span id="username"></span>!</p>
            <iframe id="stream-clip" width="1280" height="720">
            </iframe>
        </div>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io.connect('<your webpage url goes here>');
            socket.on('shoutout', (response) => {
                // check to make sure the event is for your channel
                const streamer = response.streamer; // streamer we are shouting out
                const host = response.host; // stream where the shoutout is occurring
                const pathnameHost = window.location.pathname.replace(/^\/|\/$/g, '').split('/')
                let duration;
                response.duration ? duration = response.duration : duration = 15;
                if (!streamer || !pathnameHost.includes(host)) { 
                    return; // if the event is not for your channel, return early
                }
                let channel = document.querySelector("#username");
                channel.textContent = streamer;
                getClips(streamer, undefined, undefined, duration).then(_ => {
                    const clip_data = getRandomWeightedClip(topClips);
                    // if we don't have a clip, do nothing
                    if(clip_data) { setClip(true, clip_data); }
                    // TODO: log the clip name and streamer to server side
                }).catch((err) => { console.error(err) });
            });
        </script>
    </body>
</html>